<!DOCTYPE html>
<html>
   <head>
      <title>VSCode Flavored Markdown Preview</title>
      <link rel="icon" type="image/svg" href="icon.svg" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <link
         rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
      />
      <link
         rel="stylesheet"
         href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css"
      />
      <link
         rel="stylesheet"
         href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github.min.css"
      />
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link
         href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Noto+Sans+SC:wght@100..900&display=swap"
         rel="stylesheet"
      />
      <script type="module">
         import markdownIt from "https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/+esm";
         import vscodemarkdownItKatex from "https://cdn.jsdelivr.net/npm/@vscode/markdown-it-katex@1.1.2/+esm";
         import highlightjs from "https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/+esm";

         const MarkdownIt = markdownIt({
            html: true,
            highlight: function (str, lang) {
               if (lang && highlightjs.getLanguage(lang)) {
                  try {
                     return highlightjs.highlight(str, { language: lang })
                        .value;
                  } catch (err) {}
               }
               return "";
            },
         });
         MarkdownIt.use(vscodemarkdownItKatex.default);
         const raw = document.querySelector("#raw");
         const previewer = document.querySelector("#preview");
         const renderRaw = () => {
            previewer.innerHTML = MarkdownIt.render(raw.value);
         };
         let lastEdit = 0,
            lastEditId = 0;
         document.querySelector("#raw").addEventListener("input", () => {
            let id = ++lastEditId;
            lastEdit = new Date().getTime();
            setTimeout(() => {
               if (new Date().getTime() - lastEdit > 160 && lastEditId == id) {
                  localStorage.setItem("Raw", raw.value);
                  renderRaw();
               }
            }, 200);
         });
         if (localStorage.getItem("Raw") == null) {
            localStorage.setItem(
               "Raw",
               '这是一个简易的 Markdown 预览工具，其表现与 Visual Studio Code 中 Markdown 预览功能相近，您可以点击上方的“预览”、并使用打印中的“另存为 PDF”将您的 Markdown 文档保存为打印质量的 PDF 文件。  \n<small>您可以在打印的选项中勾选背景图形以获得更美观的代码高亮。</small>\n\n**文本一**\n\n常用的等价无穷小有 $sinx \\sim x$、$ln(1 + x) \\sim x$、$a^x - 1 \\sim x \\ln a$、$[(1+x)^\\alpha - 1] \\sim \\alpha x$ 等。\n\n**文本二**\n\n```c\nprintf("Hello, world!"); // 输出 Hello, world!\n```\n\n**文本三**\n\n<div align="center">\n   这是一段居中文本\n</div>'
            );
         }
         document.querySelector("#raw").value = localStorage.getItem("Raw");
         renderRaw();
      </script>
      <style>
         .root {
            width: calc(100% - 4.8em);
            height: calc(100% - 4.8em);
            left: 0;
            top: 0;
            position: absolute;
            margin: 2.4em;
            display: flex;
            flex-direction: column;
            gap: 0.8em;
         }

         .root > .title {
            font-family: "JetBrains Mono", "Noto Sans SC", monospace;
            display: flex;
            justify-content: space-between;
         }

         .root > .title > .name {
            font-size: 1.4em;
         }

         .root > .title > .btn-preview {
            border: none;
            background: #607d8b;
            color: #fff;
            box-shadow: 0 3px 4px rgba(0, 0, 0, 0.2);
            font-size: 0.96em;
            padding: 0.25em 1em;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.24s background, 0.24s box-shadow;
         }

         .root > .title > .btn-preview:active {
            background: #5a7987;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
         }

         .root > .main {
            display: flex;
            height: inherit;
            gap: 0.8em;
         }

         @media screen and (max-width: 480px) {
            .root > .main {
               flex-direction: column;
            }
         }

         .root > .main > textarea#raw {
            outline: none;
            resize: none;
            background: #f5f5f5;
            border: 1px #cfd8dc solid;
            padding: 1.4rem;
            border-radius: 8px;
            flex: 1;
            box-sizing: border-box;
            font-family: "JetBrains Mono", "Noto Sans SC", monospace;
            font-optical-sizing: auto;
            font-style: normal;
         }

         .root > .main > div#preview {
            flex: 1;
            border: 1px #cfd8dc solid;
            overflow-y: auto;
            padding: 1.4rem;
            border-radius: 8px;
            font-family: "Noto Sans SC", sans-serif;
            font-optical-sizing: auto;
            font-style: normal;
         }

         .markdown-body pre,
         .markdown-body code {
            font-family: "JetBrains Mono", "Noto Sans SC", monospace !important;
            text-wrap: auto !important;
         }

         body > div#preview.fullscreen {
            z-index: 100000;
            background: #fff;
            margin: 1.6rem;
            position: relative;
            border: none;
         }
      </style>
   </head>
   <body>
      <div class="root">
         <div class="title">
            <div class="name">VSCode Flavored Markdown Preview</div>
            <button class="btn-preview">预览</button>
            <script>
               document
                  .querySelector(".btn-preview")
                  .addEventListener("click", () => {
                     document.title = "Markdown File";
                     const origin = document.querySelector("#preview");
                     origin.classList.add("fullscreen");
                     document.body.append(origin);
                     document.querySelector(".root").remove();
                  });
            </script>
         </div>
         <div class="main">
            <textarea id="raw"></textarea>
            <div id="preview" class="markdown-body"></div>
         </div>
      </div>
   </body>
</html>
